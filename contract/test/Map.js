const { expect } = require("chai");
const { ethers } = require("hardhat");
const hre = require("hardhat");

async function deployVerifier() {
  const UltraVerifier = await hre.ethers.getContractFactory("UltraVerifier");
  const ultraVerifier = await UltraVerifier.deploy();
  await ultraVerifier.deployed();
  console.log(ultraVerifier.address);
  return ultraVerifier.address;
}

async function deployMap({ verifierAddress }) {
  const timeline = await ethers.deployContract("Map", [verifierAddress]);
  await timeline.deployTransaction.wait();
  return timeline;
}

async function newLocation({ map, proof, input }) {
  const public_inputs = [
    ...input.map((x) => ethers.utils.hexZeroPad(ethers.utils.hexlify(x), 32)),
  ];

  await map.addLocation(proof, public_inputs);
}

describe("Map contract", function () {
  it("Deployment", async function () {
    const [owner] = await ethers.getSigners();

    const verifierAddress = await deployVerifier();
    const map = await deployMap({
      verifierAddress: verifierAddress,
    });
  });

  it("Location", async function () {
    const verifierAddress = await deployVerifier();
    const map = await deployMap({
      verifierAddress: verifierAddress,
    });

    await newLocation({
      map: map,
      proof:
        "0x2ba29a298f91c59f879946855710e633e046878f9ecbb5f45b9c81d57059519e17bd01c1dd232a4701df4e4c88eb294c8c5dae1803b0b3363ac727d029ed98c808d735b317bf59a71771495d0256ae2ff12246a28e56448fae709bdca2748c9d2b301fceace9c1cd5fff802fdd7379b9fb7991a0835bce07acc03a9f11b418f40a2bbc1e0c963405df75931aad40b981eb69600390197775fad5278a712db5d11f9fbc16dac4d23bd26303ef7c7ee183a2ad02a61164da8496f747a07810c2e405f30da8234c53ffad64fba9e6d6a2c76fb2cc76c8e031461a3ab9a2dd8398b9159e2ea10463a8d482d61908bb376ee2829e06f239713dabaa1cd8dc26c5ad7e232354fea2a18c1306af917aa10932ea469d3f5879cb8ed7359ea8f2242f0d090c3f2b3068028910a4bf9a48f2b5e2045c50cc7446d5574d769e0d99a00e17f920ad7bd29700782e3ab3318835784a7ba09591ea8da58150e912b94ea0dd33a30f46b89918b8931d7cb25d4e53a63513c9ca25a0e2affaa0e5ce9790269c967b2409550bc8be606a700b1f5a7ef3d1b93e14d357d89f01ea0d8ebc2cc40628c02044034fbabe912521b9f286ec80f359451c3290d5aa3cf174f2a1172e885f581a0d3395522c5d7fc452d12919c7b6353a84d28eb01f37967315051d90e2c8a82d396d1d2f7007b925be31b2e2a987571ce68d0abe83426d6e3c0a48a93113d71547788e82b0cf4bdcf863c9e96e1f623304b102dd4edc83c70234d7b2aca0e1274fe4981b3af4041ef786d1b361947faddad309ed05c051fccd71658800771d055733e4cd7e4b56d40b66046d1ac6e0428cb189c6370bbbafa8e1793b84c32827b1bcaed5027295ae500cca65eb99ca3d32df7e5c5b8d5f271605ee66e6f8052251db2c31392e009f360915f08995de904f4462b5f2139d04daf01a157e2fa40bef72f1f7524d3978916529ad57bd7ced173ad0fa0bf58b50f657779cba85862a2994e426bd991c808a020a65707e2257831912db33fc7aa1becb1bd5bc2f9f0552ea3448e67607b05d0a69ab3211624efb2695be395dca53e027e5229c9abd083c6d0f02037434bd851edc532d766f227872a351fef8c6474b51972806ef7614c66557582c86136a430aba9a40a97ed3e052a8e67a57ca0adaf52a52706b402ccc137fa8f074f1b248c691ad16dad318d402c69e328836a3424de63bdef8972599f4709308cf440d71d6e4ed9deeec4e4f3f8f8b8568753a8c44a5f354002c0cb9423e3f02fda8e83a79d161b31427b307f9fdbb5ce95c76b0938b2f3cf9d12dc2458f6fd5a8b229315eda0d015b380697bc0581a4370a144f640e915698d702d2cebfd0b0a6c7ad8ae06079ac6069d773298d376061019fdbba0dc984f074211f0c4c51339c364f93abce2738203f94395d3a645883b116e1ab079d1c2500095daa090ca6a474c3f27ced4f5f309cb5abcb233d4cc490fca0dff20d0c01990c8de76b7ef13798c863769d4419cf8bb9a64d68274de4997422a52e37a4bd5a2f010e28ecde38cbf97b74226e3e76d4f47d4ce9229347c7fa3defac94ec7f1a030a5d98a97062cd229236b3726b667e2ede52975b61ac081138696692004c712a10652c475a45080d4e8df8190dab4ff341c38676782cea1ff5ea76e9ec5f402795193c7ebfee89a68109f400ad99a792d283c2100b278e0f3f1fe4b08cf01c276ff5c8347430b2351b8455b8c266d187ad4a960c686b2bd1fb958ba477bec81c54062d97a3e7dfd5edac6c3c0fbdee9024412c04d94fab956670191c6cb536122ee06eb0bc9554cbf7ef4b7656bdc1b3fa98fc68299ed66217195f0aea00f11f6a6c4e47e45630e4158c69e18fc1edcc39e2add0d02be1874fb94a46eda7a610a141e7524374233dad5aeb8e90afd1840999572c7f3bc1847a57b2ac943be72511bd861a6767da7fccf1da4773a482d640e4432ce5430b463054a558132c8b0c1ddfcea7ca724db5552e63f901a770661df3d127e14a09359a3247c3599835279180c2862a2bea878c69e4fef403e3a22fb9f656d83efcdbd1febaa21f140e292fab818ba41aeb4028e82b977d707ac56c7d27fabc64f5c1f8e1eb91d5cb680c0b720e267583aa60c3273379b7079075f5c7ae0465c694706ab58296c678d70e432411f2f751c98ca8e8b7d89dc77005a8f7206895112a8dd762c605f0a67f29dcef676f5ac17925c6283eafb79e48875e214ba4071d81485246709b0e50af1618b999e416df86f0653101fc3a8ae99dd14de32a6cdc22ac7a75df803b916510e1ce5af3f6ef0839bbd7c9f52922c0c609f2428f23a35cbcd30285c9c3b18e1e5e5979c11a4529fe6a1fea17804ad471acd463bf0e710f2ccd52b5fb6d9e66148ef82c092c25826646d83cbd816dc0c2655a878aa23cb362534ee3f096f5a2206fd161ab393aafa3b97764cf5d9cbe0d1d454904fabfdebb9afe1d1f81561523f333f1c08b08d86fd9075b13b61be2a59bb50e3fc1c3f0c2680fdea62276691896ebfb5ee1994b607df144ec696b376199265edf46609059e018864fc134240b24957b00f3761915111166d6a498121670060fb372cd373fe6fff609669d862fbe39893368f71569a3970b0ae32b7f86115a271a9f9b31c30a14808d83cfef174540775bab7d6efa3058b961c91781f8afcf7279ba9605613fab94585ad225275d551c78255f025bf1a7f18f4908a039b6ab1ee6ce84628dbddd125fc934822cb7389fd2090f9f539c31a3b06f654437ff1f95186405fe1d551f1037a52f7312139040b5e302f5ecc74364b3e72ee3d52e9b159b16dbb052d548479b642e2a132c83a7ca74aa91728507e14190302a3a2a86f4c1f96406e968b71e829e96410296dfcc9ed5f6cc68777a566c6730cf9c8c1d6134785487f90ae1dc9bacad3610ceb0fbdc2d00b7f6f6440c90a3ddc1311a28fcbbd2f93234058f45074af4990acdd22ffe264043c6055bbf8e528380dbdb50e6efe1683a70bc29f2e90ab7b8",
      input: [
        255025314028904300000n,
        181389858302534120000n,
        264511056986891260000n,
        201604539433064n,
        100452032164069310000n,
        258788340812111220000n,
        63472698259184075000n,
        594959747773500n,
        220804286842565400000n,
        238459744272756830000n,
        208944653838857570000n,
        215707213352681n,
        156062629165282720000n,
        13493872732322906000n,
        38397630671842484000n,
        560010585536663n,
      ],
    });
  });
});
