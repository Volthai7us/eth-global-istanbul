const { ethers } = require("hardhat");
const hre = require("hardhat");

async function deployVerifier() {
  const UltraVerifier = await hre.ethers.getContractFactory("UltraVerifier");
  const ultraVerifier = await UltraVerifier.deploy();
  await ultraVerifier.deployed();
  console.log(ultraVerifier.address);
  return ultraVerifier.address;
}

async function deployMap({ verifierAddress }) {
  const timeline = await ethers.deployContract("Map", [verifierAddress]);
  return timeline;
}

async function newLocation({ map, proof, input }) {
  const public_inputs = [
    ...input.map((x) => ethers.utils.hexZeroPad(ethers.utils.hexlify(x), 32)),
  ];

  await map.addLocation(proof, input);
}

describe("Map contract", function () {
  it("Deployment", async function () {
    const [owner] = await ethers.getSigners();

    const verifierAddress = await deployVerifier();
    const map = await deployMap({
      verifierAddress: verifierAddress,
    });
  });

  it("Location", async function () {
    const verifierAddress = await deployVerifier();
    const map = await deployMap({
      verifierAddress: verifierAddress,
    });

    await newLocation({
      map: map,
      proof:
        "0x127a8c0e2a7989e8c33db11d5e14acb33a0cdf2bb929b045a4433dce961cbf231f5ec551c1480696a79bcf1fb10416ec726f48f70bdd16d878190483fd8b8b002ef30d8152a7ce22ec7f7131f4c66d8a5f6d00f3a77d0f3a9027c371d44fa2ce1193e6aa52a71cf7c0742f1dd10b007d96bd87382c88b6a4686c0bb47bd079320c129507ca2a168890243a31026503d93bc37c44e234b021f08d894936bebc011fa3c79444ac88bd4bc99b3cac1fe7da09ed20e247d52b87b3d74306f91a50642390283a4a7eb07ce89d3b8714b3f4b413db2fb15a37bba50b86aa08ac5ccb21190685c42db2201420bb0c4d039003cf064508f2710bb7ab176b5755e3fe37240808d578e6dc3f455d0e575ef98f0d72b951b761347b7c724f4f097e1c051bc60d039fbdf05554dfce5f19f95138521fb81f5ef693e9a5f9364430dc09e4afc029a9ed9c46b3047c7efc09a5f06b4455f25789aa8ed6222019d958c60d729719181dce83f07ecb1dd3116eb4a87be4cd9e78d2cb5bc2b6f57688961f1b55f6ba289fcbb41fc5454cc755961efd920bdc3f1d651312fb8b2c37342263c746ffe90052ec47631d2ee82a4f9f666611d6b43b3d73c75cfa6f74043707e24c5a1fa72ebddb6183edaae6bc19ae4e7ad480ead5768e82f3172e227073f226e1ad3f520d23f22e483955f50fdc7ddcfbfab9ebbee6efad7e11dd3ac5742b12132621951cc99a105a97faaf627db4396edc38e0e9a349edd96c06cac497854471b1b1d8172af78f4e49796f74a957134e46cbd71a7b40e80a79ce91e872039e31b9f08f2435acf646867f92524ce25cc2fc6cb110ae36507fbc23432b5f709056be5e7e107423b2e21c14cfbf4bb99dfcfe66334c05e823d8b3b73635d24ed35ec3e34113743be22fc6618dbb2abd0c012d917b7b9dd3a1af5bb46044b50ad738d227202b0f2b61a03d4d5161032cbfdaf1b6cd64aa89f24e1b04ef9d05b759444dae0f2046a0c7acc46207a190f0992bc3b64519c963bcdafc548a1ccdbb9c90346fb418842b5ef61a8e567c707b143e1a7822c0b00b4627ef7742ae58bf1f81fe4bf91d65bfb536eaed685cc8cc784faed78d518b2e24ef4f34bbdafce816e49b06240eed9c07ea3a807ad3de966af7890564fa4ac51c6c8465b098102cb5566b3e94285ed874318c9c264d3761ec836324a3ec6b66d6770f592086515127bfd7c6c2252b71460c3bf44d9d6dd16f51d5338a1f2cddcc983553966f6b061203d77a0809aaf93e8c57a679a58fd4043c5b43ce3cca024a48fb5f1bef5067380f7742a924ab073a3d0f65d80f62740f5f506a8ddcbcd31ffa0ff5ba32836681b4e497ba2682a8b705a81c4fca8977aaa32e348f16c902c4d3742f1fe29b251c07a4fab6028b340e6b236c2f8fb4a235d48277698b327da298495d757e1e8d45927935e41298c91173a412028eb362473b5bf136a7d1a4ae9f4863e81a2bf2abe8634c4f0331fb3984e338a3284f661e5987d4cd8d27ff24ed414162948d2be26ecb77ee1dadea64192ec7888cdc172a5c8ecfea403ded056e537a67539f03662e710d530ff2b1ccb82fa54e5c649688e3166d3f844970e4f2f929a2cf40e4f5bfe7f33e1499c2a57557512bba16e1c75a0e5e729239a03056e1d1a8eb1780fff0c095f518d18578223680b2790b70398e37a669ea211d33703bb3e78cd38a659412c8f303c4a49e4fdd3ef16493c8780171cf7478019f786f27410dc17692bfcc3311d40dde75e428532e84cf0b010110e7b82613d61a03133ef925cde958591aaaec32208663d5f681cbbd180ecb4bb9962148f68cd3d8954d1adff6a9de5d4fbaace51608c4e3c6f39019cc570fe1e9d4638ba4adf535ef481e4f694323123eb1097c1cbfa5a827d5464bbc2a9566dfaa25bb7dac2109ce722d322f66a37ce4eb32ec21071b14f7335f34353c8f532eb1d9ba38d481b8f2378ea46b4746a29836390d072a76e372cc188ce22c6813f181d3f6af308549f8c7466d639b11eca800c0862f96520acdffed4c8c81c2fe6038e0147aedfa6f90d8e2368c36c04c4011514607a3d636005a9e749cce58400c4ad4a97c4ab0f1df89a672b0ee82aecd62dc6114384d190f7be52face6b3a30eed69369c88147338158580e75664b1083143b5216abdf40b537456bf3dec2dc5a9d305cd78658ec5d433819f0436e2f0e77e242dc5329ec7948f9e34a44233b268535db25627d165c224cc7ed88e622d21dd542c8df6185df14b8b5e6211b88b6a76e1d03a59901155066232e4de27645f03de27921353f51040685c03c3f531b7519bae1e1981596cf5c7d3fd44340d7a6d791dfbbf12081c09d518f1b4d12e37c0a9cb744eb362267e8eee2215dad80678f800d120a5a58237f58af33334c6856af7c4730214eaeb56536712691794809f871e4e56f8e99298d12629dab3a30bef877237efed91fcd719e96abedfdc72e383279a61c90dcf1c0177eb7878ba1a35a7d8227628e482d4e7e7ecf49ca42a77720c72d3f1b4b63d627024cc33d26d4e7b9e112960a85f7d4d35d4070d06e759d830483f145a4c960ebd48b14f80b23f39fdef8f798ce5027d3fc6beb8b674c33413d031634e51fa6b5121642ed8ca4e7692b8819d864059b62e950964ba66e0110b7ee24ab1f668c972ef620dce7e72b931663fbd923172e2e9c3615d1ddbcaed1065576ccc806eed83b3e2d8b44df97a6377e55be42076f0de35f8b33274690613456c8479361a2410f90669f64ef6ea8d203220de0ece2b2cf9308e684f23b42e2a643ca0213ca9ee65d74d5102f743ee299e461ad780829e91e626e2180b8c28ce219a9dacd6f88ffee2438d0e4e48f175a268eaa54303ae4589ad58cd8db209b4aa7d41d8f6788c42461387e23411f9a20fe9d5edd7097ab7a73034e8ade21ebe9081df369ebb7bc752836fc4e5dc7b0aa15645f1aac77a4bd9d8d298997c27c399746d1558dd834294c5b9e1d1f221187e1675606c77da6457de989eda21",
      input: [
        "0x0000000000000000000000000000000000000000000000000000000000000052",
        "0x0000000000000000000000000000000000000000000000000000000000000000",
        "0x0000000000000000000000000000000000000000000000000000000000000042",
        "0x0000000000000000000000000000000000000000000000000000000000000000",
        "0x000000000000000000000000000000000000000000000000000000000000004f",
        "0x0000000000000000000000000000000000000000000000000000000000000000",
        "0x000000000000000000000000000000000000000000000000000000000000003d",
        "0x0000000000000000000000000000000000000000000000000000000000000000",
        "0x0000000000000000000000000000000000000000000000000000000000000063",
        "0x0000000000000000000000000000000000000000000000000000000000000000",
        "0x000000000000000000000000000000000000000000000000000000000000003a",
        "0x0000000000000000000000000000000000000000000000000000000000000000",
        "0x000000000000000000000000000000000000000000000000000000000000007a",
        "0x0000000000000000000000000000000000000000000000000000000000000000",
        "0x0000000000000000000000000000000000000000000000000000000000000047",
        "0x0000000000000000000000000000000000000000000000000000000000000000",
        "0x0000000000000000000000000000000000000000000000000096a6b668a59f19",
        "0x00000000000000000000000000000000000000000000000afe7f4e14396b3ff1",
        "0x00000000000000000000000000000000000000000000000232e2bf20041552cf",
        "0x0000000000000000000000000000000000000000000000000000080d1db3fe89",
        "0x00000000000000000000000000000000000000000000000fb383d8d5d10058d9",
        "0x00000000000000000000000000000000000000000000000e15995b14b2143eb7",
        "0x00000000000000000000000000000000000000000000000bba3424d7e4127835",
        "0x000000000000000000000000000000000000000000000000000208d632dd9689",
        "0x00000000000000000000000000000000000000000000000e8f65e1062c3be333",
        "0x000000000000000000000000000000000000000000000003e50a256fb02c19c9",
        "0x000000000000000000000000000000000000000000000007c81d87f41e4b2e1e",
        "0x0000000000000000000000000000000000000000000000000002f5f91e2541cc",
        "0x000000000000000000000000000000000000000000000005d2081e224b4d4b21",
        "0x00000000000000000000000000000000000000000000000bcb90f9b7d4db2bad",
        "0x000000000000000000000000000000000000000000000008dcde769f4c51999d",
        "0x000000000000000000000000000000000000000000000000000252642abc8a0d",
      ],
    });

    const count = await map.addressLocationCount();

    const loc = await map.addressLocation(count - 1);

    console.log(loc);
  });
});
